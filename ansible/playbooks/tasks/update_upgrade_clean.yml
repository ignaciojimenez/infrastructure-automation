---
# Full update, upgrade and clean - Migrated from raspberrypi-ansible

- name: Update apt repo and cache
  ansible.builtin.apt:
    update_cache: true
    force_apt_get: true
    cache_valid_time: 3600
  tags: [updates]

- name: Upgrade all packages
  ansible.builtin.apt:
    upgrade: dist
    force_apt_get: true
  tags: [updates, upgrade]

- name: Apt autoremove autoclean and clean application
  ansible.builtin.apt:
    autoremove: true
    autoclean: true
    clean: true
  tags: [updates, cleanup]

- name: Check if reboot required
  ansible.builtin.stat:
    path: /var/run/reboot-required
  register: reboot_required
  tags: [updates]

- name: Report reboot status
  ansible.builtin.debug:
    msg: "{% if reboot_required.stat.exists %}⚠️ Reboot required{% else %}✅ No reboot required{% endif %}"
  tags: [updates]
