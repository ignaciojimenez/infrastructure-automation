# Samba configuration file
# Generated by Ansible

[global]
   workgroup = {{ samba_workgroup | default('WORKGROUP') }}
   server string = {{ samba_server_string | default('%h server (Samba, Ubuntu)') }}
   dns proxy = no
   
   # Logging
   log file = /var/log/samba/log.%m
   max log size = 1000
   syslog = 0
   
   # Authentication
   security = user
   encrypt passwords = true
   passdb backend = tdbsam
   obey pam restrictions = yes
   unix password sync = yes
   passwd program = /usr/bin/passwd %u
   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .
   pam password change = yes
   map to guest = bad user
   
   # Network
   bind interfaces only = {{ samba_bind_interfaces_only | default('no') }}
   interfaces = {{ samba_interfaces | default('127.0.0.0/8 eth0') }}
   
   # Performance
   socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBUF=131072 SO_SNDBUF=131072
   read raw = yes
   write raw = yes
   max xmit = 65535
   dead time = 15
   getwd cache = yes

# Share definitions
{% for share in samba_shares | default([]) %}
[{{ share.name }}]
   comment = {{ share.comment | default('Samba share') }}
   path = {{ share.path }}
   browseable = {{ share.browseable | default('yes') }}
   guest ok = {{ share.guest_ok | default('yes') }}
   read only = {{ share.read_only | default('no') }}
   create mask = {{ share.create_mask | default('0755') }}
   directory mask = {{ share.directory_mask | default('0755') }}
{% if share.valid_users is defined %}
   valid users = {{ share.valid_users }}
{% endif %}
{% if share.write_list is defined %}
   write list = {{ share.write_list }}
{% endif %}

{% endfor %}
