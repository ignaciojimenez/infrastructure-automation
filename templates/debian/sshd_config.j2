# SSH Configuration - Migrated from raspberrypi-ansible
# Generated by Ansible - {{ ansible_date_time.iso8601 }}
# Host: {{ inventory_hostname }}

# System logging
SyslogFacility AUTHPRIV

# Authentication methods
GSSAPIAuthentication yes
GSSAPICleanupCredentials no
UsePAM yes

# Disable X11 forwarding for security
X11Forwarding no

# Environment variables to accept
AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
AcceptEnv XMODIFIERS

# SFTP subsystem
Subsystem	sftp	/usr/lib/openssh/sftp-server

# Security settings
PermitRootLogin no
PasswordAuthentication {{ ssh_password_auth | default('no') }}
ChallengeResponseAuthentication no
PubkeyAuthentication yes
AuthorizedKeysFile  .ssh/authorized_keys

{% if update_key_script is defined %}
# Dynamic authorized keys
AuthorizedKeysCommand	{{ update_key_script }}
AuthorizedKeysCommandUser	nobody
{% endif %}

# Connection settings
ClientAliveInterval 300
ClientAliveCountMax 2
MaxAuthTries 3
MaxSessions 10

# Restrict to specific users if defined
{% if ssh_allowed_users is defined %}
AllowUsers {{ ssh_allowed_users }}
{% endif %}
